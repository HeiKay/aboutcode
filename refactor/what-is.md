
## 重构原则

何谓重构：

1. 名词：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本
2. 动词：使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构
- 为何重构
    
    重构是控制代码的工具
    
    1. 改进软件设计
        1. 维持代码的设计，避免在开发中流失原有结构
        2. 改进设计，消除重复
    2. 更容易理解
        1. 减少从业者阅读障碍
        2. 协助理解不熟悉的代码
    3. 帮助找到bug
    4. 提高编程速度
        1. 良好的设计是维持软件开发速度的根本
- 何时重构
    
    三次法则：事不过三，三则重构
    
    重构应该随时随地进行
    
    1. 添加功能时
    2. 修补错误时：清晰的代码结构可以快速定位问题
    3. 复审代码时
- 怎么对经理说
    
    看经理本质是关心什么，有时建议不要告诉。
    
- 间接层和重构
    
    间接层是把双刃剑，当然也有很大价值：
    
    1. 允许逻辑共享
    2. 分开解释意图和实现
    3. 隔离变化
    4. 封装条件逻辑：多态消息
    
    重构可以是为系统增加有质量的间接层，也可以是**拿掉不值得的间接层**
    
- 重构的难题
    
    万事万物都有局限性，重构也需要持有监控
    
    1. 数据库
    对象数据库和业务的强耦合，数据迁移问题。非对象数据库中，分隔层隔离对象模型和数据库模型的变化，可以在合适的时候加入分隔层。
    2. 修改接口
        1. 维护新旧接口，标记旧接口（deprecated）
        2. 避免过早发布接口，修改代码的所有权政策，使重构顺畅
    3. 难以通过重构手法完成的设计改动：要对重构难度有把握
    4. 何时不该重构
        1. 现有代码无法稳定运作，重写工作优于重构
        2. 项目临近deadline
- 重构与设计
    
    重构可以减轻预先设计的压力，优化应先实际度量系统的性能，再进行重构。
    
- 重构与性能
    
    高效编程：先写出可调的软件，然后调整它以获得足够速度
    
    1. 时间预算法：给定组件预定资源
    2. 持续关注法：常导致过度优化
    3. 度量程序，利用90%的统计数据：性能优化阶段